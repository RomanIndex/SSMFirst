<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.bf.fuqing_home.dao.IQxyVideoClassifyDao" >
  <resultMap id="BaseResultMap" type="com.bf.fuqing_home.entity.QxyVideoClassify" >
    <id column="ID" property="id" jdbcType="VARCHAR" />
    <result column="PARENT_ID" property="parentId" jdbcType="VARCHAR" />
    <result column="TYPE_NAME" property="typeName" jdbcType="VARCHAR" />
    <result column="ROW_NUM" property="rowNum" jdbcType="DECIMAL" />
    <result column="TOTAL" property="total" jdbcType="DECIMAL" />
    <result column="SEQUENCE" property="sequence" jdbcType="DECIMAL" />
    <result column="LEVEL_NUM" property="levelNum" jdbcType="DECIMAL" />
    <result column="STATUS" property="status" jdbcType="DECIMAL" />
    <result column="CREATE_USER" property="createUser" jdbcType="VARCHAR" />
    <result column="CREATE_TIME" property="createTime" jdbcType="TIMESTAMP" />
    <result column="UPDATE_USER" property="updateUser" jdbcType="VARCHAR" />
    <result column="UPDATE_TIME" property="updateTime" jdbcType="TIMESTAMP" />
  </resultMap>
  
  <!-- view map -->
  <resultMap id="QxyVideoClassifyViewMap" type="com.bf.fuqing_home.view.QxyVideoClassifyView" extends="BaseResultMap">
    <result column="PARENT_NAME" property="parentName" jdbcType="VARCHAR" />
    <collection property="secondClassify" ofType="BaseResultMap" column="faid" select="getSecondClassify"></collection>
  </resultMap>
  
  <select id="getParent" resultMap="QxyVideoClassifyViewMap">
    select * from qxy_video_classify vc where vc.id = #{id}
  </select>
  
  <select id="getMaxSeq" resultType="int">
    select NVL(max(vc.sequence),0)
	  from qxy_video_classify vc
	  <where>
         <choose>
             <when test="level == 2">vc.parent_id = #{parentId}</when>
             <when test="level == 1">vc.parent_id is null</when>
          </choose>
      </where>
  </select>
  
  <update id="moveSeq">
    update qxy_video_classify vc set vc.sequence = vc.sequence + 1
    <where>  
         <choose>  
             <when test="level == 2">vc.parent_id = #{parentId} and vc.sequence &gt; #{seq}</when>
             <when test="level == 1">vc.parent_id is null and vc.sequence &gt; #{seq}</when>
          </choose>
      </where>
  </update>
  
  <select id="getClassifyByLevel" resultMap="QxyVideoClassifyViewMap">
    select vc.*, VC.ID faid
      from QXY_VIDEO_CLASSIFY VC
     where VC.PARENT_ID is null and VC.STATUS = 1
     order by VC.SEQUENCE
  </select>
  
  <update id="exchange">
   UPDATE qxy_video_classify
      SET sequence = (CASE WHEN id = #{id1} THEN (SELECT sequence FROM qxy_video_classify WHERE id = #{id2})
                        WHEN id = #{id2} THEN (SELECT sequence FROM qxy_video_classify WHERE id = #{id1}) 
                   END)  
    WHERE id=#{id1} OR id=#{id2}
  </update>
  
  <select id="getSecondClassify" resultMap="BaseResultMap">
    select *
      from qxy_video_classify
     where parent_id = #{faid}
     order by SEQUENCE
  </select>
  
  <select id="getFirstCategory" resultMap="QxyVideoClassifyViewMap">
    select * from qxy_video_classify vc where vc.parent_id is null and vc.status = 1 order by vc.sequence
  </select>
  
  <delete id="deleteById" parameterType="java.lang.String" >
    delete from QXY_VIDEO_CLASSIFY where ID = #{id,jdbcType=VARCHAR}
  </delete>
  
  <delete id="deleteByFaId" parameterType="java.lang.String" >
    delete from QXY_VIDEO_CLASSIFY where PARENT_ID = #{id} or id = #{id}
  </delete>
  
  <update id="updateQxyVideoClassifyById" parameterType="com.bf.fuqing_home.entity.QxyVideoClassify" >
    update QXY_VIDEO_CLASSIFY
    <set>
      <!-- <if test="parentId != null" >
        PARENT_ID = #{parentId,jdbcType=VARCHAR},
      </if> -->
      <if test="typeName != null" >
        TYPE_NAME = #{typeName,jdbcType=VARCHAR},
      </if>
      <if test="rowNum != null" >
        ROW_NUM = #{rowNum,jdbcType=DECIMAL},
      </if>
      <if test="total != null" >
        TOTAL = #{total,jdbcType=DECIMAL},
      </if>
      <if test="sequence != null" >
        SEQUENCE = #{sequence,jdbcType=DECIMAL},
      </if>
      <if test="levelNum != null" >
        LEVEL_NUM = #{levelNum,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        STATUS = #{status,jdbcType=DECIMAL},
      </if>
      <if test="updateUser != null" >
        UPDATE_USER = #{updateUser,jdbcType=VARCHAR},
      </if>
        UPDATE_TIME = SYSDATE,
    </set>
    where ID = #{id,jdbcType=VARCHAR}
  </update>
  
  <insert id="addQxyVideoClassify" parameterType="com.bf.fuqing_home.entity.QxyVideoClassify" >
    insert into QXY_VIDEO_CLASSIFY
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="parentId != null" >
        PARENT_ID,
      </if>
      <if test="typeName != null" >
        TYPE_NAME,
      </if>
      <if test="rowNum != null" >
        ROW_NUM,
      </if>
      <if test="total != null" >
        TOTAL,
      </if>
      <if test="sequence != null" >
        SEQUENCE,
      </if>
      <if test="levelNum != null" >
        LEVEL_NUM,
      </if>
      <if test="status != null" >
        STATUS,
      </if>
      <if test="createUser != null" >
        CREATE_USER,
      </if>
      <if test="createTime != null" >
        CREATE_TIME,
      </if>
      <if test="updateUser != null" >
        UPDATE_USER,
      </if>
      <if test="updateTime != null" >
        UPDATE_TIME,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="parentId != null" >
        #{parentId,jdbcType=VARCHAR},
      </if>
      <if test="typeName != null" >
        #{typeName,jdbcType=VARCHAR},
      </if>
      <if test="rowNum != null" >
        #{rowNum,jdbcType=DECIMAL},
      </if>
      <if test="total != null" >
        #{total,jdbcType=DECIMAL},
      </if>
      <if test="sequence != null" >
        #{sequence,jdbcType=DECIMAL},
      </if>
      <if test="levelNum != null" >
        #{levelNum,jdbcType=DECIMAL},
      </if>
      <if test="status != null" >
        #{status,jdbcType=DECIMAL},
      </if>
      <if test="createUser != null" >
        #{createUser,jdbcType=VARCHAR},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="updateUser != null" >
        #{updateUser,jdbcType=VARCHAR},
      </if>
      <if test="updateTime != null" >
        #{updateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  
</mapper>